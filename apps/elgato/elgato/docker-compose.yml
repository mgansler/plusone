version: '3'

services:
  app:
    image: elgato-app:latest
    network_mode: host
    restart: always
    environment:
      TZ: 'Europe/Berlin'
      DATABASE_URL: 'file:/usr/elgato/sqlite/elgato.db'
    volumes:
      - sqlite:/usr/elgato/sqlite/
    labels:
      - 'traefik.http.services.elgato-app.loadbalancer.server.port=3001'
      - 'traefik.http.routers.elgato-app.rule=Host(`elgato.ludwigstrasse.dynv6.net`) || Headers(`X-ELGATO-LIGHTS`, `X-ELGATO-LIGHTS`)'
      - 'traefik.http.routers.elgato-app.tls=true'
      - 'traefik.http.routers.elgato-app.tls.certresolver=letsencrypt'

volumes:
  sqlite:
    driver: local
